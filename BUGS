We need to use errno more and add more error checking.
